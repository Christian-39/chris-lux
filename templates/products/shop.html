{% extends 'base.html' %} {% load static %}{% load humanize %}
<!-- prettier-ignore -->
{% block title %}Shop - {{ SITE_NAME }}{% endblock %} {% block content %}

<!-- Breadcrumb -->
<section class="breadcrumb-section">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Shop</li>
      </ol>
    </nav>
    <h1 class="mt-3">Shop All Products</h1>
  </div>
</section>

<!-- Shop Section -->
<section class="section-padding">
  <div class="container">
    <div class="row">
      <!-- Sidebar Filters -->
      <div class="col-lg-3 mb-4 mb-lg-0">
        <div class="filter-sidebar">
          <!-- Search -->
          <div class="filter-section mb-4">
            <h5 class="filter-title">Search</h5>
            <form action="{% url 'shop' %}" method="get">
              <div class="input-group">
                <input
                  type="text"
                  name="q"
                  class="form-control"
                  placeholder="Search products..."
                  value="{{ search_query }}"
                />
                <button class="btn btn-black" type="submit">
                  <i class="bi bi-search"></i>
                </button>
              </div>
            </form>
          </div>

          <!-- Categories -->
          <div class="filter-section mb-4">
            <h5 class="filter-title">Categories</h5>
            <ul class="filter-list">
              <li>
                <a
                  href="{% url 'shop' %}"
                  class="{% if not current_category %}active{% endif %}"
                >
                  All Products
                </a>
              </li>
              {% for category in categories %}
              <li>
                <a
                  href="{% url 'shop' %}?category={{ category.slug }}"
                  class="{% if current_category == category.slug %}active{% endif %}"
                >
                  {{ category.name }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Price Range -->
          <div class="filter-section mb-4">
            <h5 class="filter-title">Price Range</h5>
            <form action="{% url 'shop' %}" method="get" id="price-filter-form">
              {% if current_category %}<input
                type="hidden"
                name="category"
                value="{{ current_category }}"
              />{% endif %} {% if search_query %}<input
                type="hidden"
                name="q"
                value="{{ search_query }}"
              />{% endif %}
              <div class="mb-3">
                <label class="form-label"
                  >Min: ₦<span id="min-price-display"
                    >{{ min_price|floatformat:0 }}</span
                  ></label
                >
                <input
                  type="range"
                  name="min_price"
                  class="form-range"
                  min="{{ min_price|floatformat:0 }}"
                  max="{{ max_price|floatformat:0 }}"
                  value="{{ request.GET.min_price|default:min_price|floatformat:0 }}"
                />
              </div>
              <div class="mb-3">
                <label class="form-label"
                  >Max: ₦<span id="max-price-display"
                    >{{ max_price|floatformat:0 }}</span
                  ></label
                >
                <input
                  type="range"
                  name="max_price"
                  class="form-range"
                  min="{{ min_price|floatformat:0 }}"
                  max="{{ max_price|floatformat:0 }}"
                  value="{{ request.GET.max_price|default:max_price|floatformat:0 }}"
                />
              </div>
              <button type="submit" class="btn btn-sm btn-outline w-100">
                Apply Filter
              </button>
            </form>
          </div>

          <!-- Length Filter -->
          {% if length_options %}
          <div class="filter-section mb-4">
            <h5 class="filter-title">Length</h5>
            <ul class="filter-list">
              {% for length in length_options %}
              <li>
                <a
                  href="{% url 'shop' %}?length={{ length }}{% if current_category %}&category={{ current_category }}{% endif %}"
                >
                  {{ length }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}

          <!-- Texture Filter -->
          {% if texture_options %}
          <div class="filter-section mb-4">
            <h5 class="filter-title">Texture</h5>
            <ul class="filter-list">
              {% for texture in texture_options %}
              <li>
                <a
                  href="{% url 'shop' %}?texture={{ texture }}{% if current_category %}&category={{ current_category }}{% endif %}"
                >
                  {{ texture }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Product Grid -->
      <div class="col-lg-9">
        <!-- Sort and Results -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <p class="mb-0 text-muted">
            Showing {{ products|length }} of {{ product_count }} products
          </p>
          <div class="d-flex align-items-center gap-2">
            <label class="text-muted">Sort by:</label>
            <select
              class="form-select form-select-sm"
              style="width: auto"
              onchange="window.location.href = this.value"
            >
              <option
                value="{% url 'shop' %}?sort=newest{% if current_category %}&category={{ current_category }}{% endif %}"
                {%
                if
                current_sort=""
                ="newest"
                %}selected{%
                endif
                %}
              >
                Newest
              </option>
              <option
                value="{% url 'shop' %}?sort=price_low{% if current_category %}&category={{ current_category }}{% endif %}"
                {%
                if
                current_sort=""
                ="price_low"
                %}selected{%
                endif
                %}
              >
                Price: Low to High
              </option>
              <option
                value="{% url 'shop' %}?sort=price_high{% if current_category %}&category={{ current_category }}{% endif %}"
                {%
                if
                current_sort=""
                ="price_high"
                %}selected{%
                endif
                %}
              >
                Price: High to Low
              </option>
              <option
                value="{% url 'shop' %}?sort=popular{% if current_category %}&category={{ current_category }}{% endif %}"
                {%
                if
                current_sort=""
                ="popular"
                %}selected{%
                endif
                %}
              >
                Most Popular
              </option>
              <option
                value="{% url 'shop' %}?sort=name_asc{% if current_category %}&category={{ current_category }}{% endif %}"
                {%
                if
                current_sort=""
                ="name_asc"
                %}selected{%
                endif
                %}
              >
                Name: A-Z
              </option>
            </select>
          </div>
        </div>

        <!-- Products -->
        {% if products %}
        <div class="row g-4">
          {% for product in products %}
          <div class="col-6 col-lg-4">
            {% include 'includes/product_card.html' with product=product %}
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <nav class="mt-5">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a
                class="page-link"
                href="?page={{ page_obj.previous_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}"
              >
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>
            <!-- prettier-ignore -->
            {% endif %} {% for num in page_obj.paginator.page_range %} {% if page_obj.number == num %}
            <li class="page-item active">
              <span class="page-link">{{ num }}</span>
            </li>
            <!-- prettier-ignore -->
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item">
              <a
                class="page-link"
                href="?page={{ num }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}"
                >{{ num }}</a
              >
            </li>
            {% endif %} {% endfor %} {% if page_obj.has_next %}
            <li class="page-item">
              <a
                class="page-link"
                href="?page={{ page_obj.next_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}"
              >
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %} {% else %}
        <!-- No Products -->
        <div class="text-center py-5">
          <i
            class="bi bi-search"
            style="font-size: 4rem; color: var(--color-gray-300)"
          ></i>
          <h3 class="mt-4">No products found</h3>
          <p class="text-muted">Try adjusting your search or filters</p>
          <a href="{% url 'shop' %}" class="btn btn-outline mt-3"
            >Clear Filters</a
          >
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endblock %} {% block extra_css %}
<style>
  .filter-sidebar {
    background-color: var(--color-gray-100);
    padding: 1.5rem;
  }

  .filter-title {
    font-family: var(--font-serif);
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-gray-300);
  }

  .filter-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .filter-list li {
    margin-bottom: 0.5rem;
  }

  .filter-list a {
    color: var(--color-gray-600);
    font-size: 0.875rem;
    display: block;
    padding: 0.25rem 0;
    transition: color var(--transition-fast);
  }

  .filter-list a:hover,
  .filter-list a.active {
    color: var(--color-gold);
  }

  .form-range::-webkit-slider-thumb {
    background-color: var(--color-gold);
  }

  .form-range::-moz-range-thumb {
    background-color: var(--color-gold);
  }
</style>
{% endblock %}
